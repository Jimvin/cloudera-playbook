#!/bin/bash
export HUE_CONF_DIR="/var/run/cloudera-scm-agent/process/`ls -altr /var/run/cloudera-scm-agent/process/ | grep HUE_SERVER | tail -1 | awk '{ print $9 }'`"
for line in `strings /proc/$(lsof -i :{{ cdh_services | json_query('[?type==`hue`].hue_http_port') | first | default(8888) }}|grep -m1 python| awk '{ print $2}')/environ|egrep -v "^HOME=|^TERM=|^PWD="`;do export $line; done
HUE_IGNORE_PASSWORD_SCRIPT_ERRORS=1 /opt/cloudera/parcels/CDH/lib/hue/build/env/bin/hue shell << EOF
from django.contrib.auth.models import User
user = User.objects.create(username='{{ hue_admin_user }}')
user.is_staff = True
user.is_superuser = True
user.set_password('{{ hue_admin_password }}')
user.save()
EOF


